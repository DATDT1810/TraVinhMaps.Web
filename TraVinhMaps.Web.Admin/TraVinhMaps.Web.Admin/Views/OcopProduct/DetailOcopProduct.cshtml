@using TraVinhMaps.Web.Admin.Models.OcopProduct;
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model OcopProductResponse;
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    .Delete-button-image {
        position: absolute;
        top: 2px;
        right: 10px;
        background-color: rgba(169, 169, 169, 0.6);
        color: white;
        border: none;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        font-size: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        padding: 0;
    }

    .add-image-box {
        margin-top: 10px;
        width: 100%;
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px dashed #aaa;
        position: relative;
        cursor: pointer;
        border-radius: 9px;
        background-color: #f8f9fa;
    }

    .upload-placeholder {
        font-size: 48px;
        color: #aaa;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        height: 100%;
        cursor: pointer;
    }

    .upload-placeholder:hover {
        background-color: #e0e0e0;
    }
</style>
<div class="page-body">
    <div class="container-fluid">
        <div class="page-title">
            <div class="row">
                <div class="col-6">
                    <h4>Ocop Product Detail</h4>
                    @if (TempData["ErrorMessage"] != null)
                    {
                        <div id="alert-message" class="alert alert-danger">
                            @TempData["ErrorMessage"]
                        </div>
                    }

                    @if (TempData["SuccessMessage"] != null)
                    {
                        <div id="alert-message" class="alert alert-success">
                            @TempData["SuccessMessage"]
                        </div>
                    }
                </div>
                <div class="col-6">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item">
                            <a href="index-2.html">
                                <svg class="stroke-icon">
                                    <use href="https://admin.pixelstrap.net/riho/assets/svg/icon-sprite.svg#stroke-home"></use>
                                </svg>
                            </a>
                        </li>
                        <li class="breadcrumb-item">ECommerce</li>
                        <li class="breadcrumb-item active">Product Page</li>
                    </ol>
                </div>
            </div>
        </div>
    </div>
    <!-- Container-fluid starts-->
    <div class="container-fluid">
        <div>
            <div class="row product-page-main p-0">
                <div class="col-xxl-4 col-md-6 box-col-12">
                    <div class="card">
                        <div class="card-body" style="height: 650px;">
                            <div class="product-slider owl-carousel owl-theme" id="sync1">
                                @if (Model.ProductImage != null && Model.ProductImage.Any())
                                {
                                    @foreach (var item in Model.ProductImage)
                                    {
                                        <div class="item" style="height: 400px;">
                                            <img src="@item" alt="image ocop product" style="width: 100%; height: 400px;" />
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="item" style="height: 90px; width: 70px;">
                                        <img class="img-fluid" src="/assets/images/no-image.png" alt="no image available" style="width: 100%; height: 100%;" />
                                    </div>
                                }
                            </div>
                            <div class="owl-carousel owl-theme" id="sync2">
                                @if (Model.ProductImage != null && Model.ProductImage.Any())
                                {
                                    @foreach (var item in Model.ProductImage)
                                    {
                                        <div class="item" style="height: 90px; width: 70px;">
                                            <img src="@item" alt="image ocop product" style="width: 100%; height: 100%; object-fit: cover; display: block;">
                                            <form asp-controller="OcopProduct"
                                              asp-action="DeleteOcopProductImage" method="post"> 
                                                @Html.AntiForgeryToken()
                                                <input hidden name="id" value="@Model.Id" />
                                                <input hidden name="imageUrl" value="@item" />
                                                <button type="submit" class="Delete-button-image"
                                                onclick="event.stopPropagation();">
                                                    &times;
                                                </button>
                                            </form> 
                                        </div>
                                    }
                                }
                                else
                                {
                                    <div class="item" style="height: 90px; width: 70px;">
                                        <img class="img-fluid" src="/assets/images/no-image.png" alt="no image available" style="width: 100%; height: 100%;" />
                                    </div>
                                }
                            </div>
                            <div class="item add-image-box">
                                <form asp-controller="OcopProduct" asp-action="AddOcopProductImage" method="post" class="upload-placeholder" enctype="multipart/form-data">
                                    @Html.AntiForgeryToken()
                                    <input type="hidden" name="id" value="@Model.Id" />
                                    <div class="upload-placeholder">+</div>
                                    <input hidden type="file" name="imageFile" multiple onchange="this.form.submit()" />
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-5 box-col-6 order-xxl-0 order-1">
                    <div class="card">
                        <div class="card-body" style="height: 650px;">
                            <div class="product-page-details">
                                <h3>@Model.ProductName</h3>
                            </div>
                            <div class="product-price">
                                @Model.ProductPrice
                            </div>
                            <hr>
                            <div style="display: flex; flex-direction: column; gap: 12px;">
                                @if (Model.Sellocations == null || !Model.Sellocations.Any())
                                {
                                    <div style="display: flex; justify-content: space-between; align-items: center;">
                                        <div>
                                            <b>No Location Name.</b><br />
                                            <span>No Location Address.</span>
                                        </div>
                                        <a asp-action="CreateSellLocation" asp-route-id="@Model.Id"
                                        class="btn btn-success btn-sm px-2 py-1"
                                        title="Create Location"
                                        style="font-size: 14px; line-height: 1;">+</a>
                                    </div>
                                }
                                else
                                {
                                    @for (int i = 0; i < Model.Sellocations.Count; i++)
                                    {
                                        var item = Model.Sellocations[i];
                                        var isLast = i == Model.Sellocations.Count - 1;
                                        <div style="display: flex; justify-content: space-between; align-items: flex-start; padding-bottom: 8px; @(isLast ? "" : "border-bottom: 1px solid #ddd;")">
                                            <div>
                                                <b>Location Name: @(item?.LocationName ?? "No Location Name.")</b><br />
                                                <b style="display: inline-block; margin-right: 8px;">Location Adress:</b>
                                                <span>@(item?.LocationAddress ?? "No Location Address.")</span>
                                            </div>
                                            <div style="display: flex; gap: 6px;">
                                                <a asp-action="CreateSellLocation"
                                                asp-route-id="@Model.Id"
                                                class="btn btn-success btn-sm px-2 py-1"
                                                title="Create Location"
                                                style="font-size: 14px; line-height: 1;">
                                                <span style="font-size: 20px;">&#43;</span>
                                                </a>

                                                <a asp-action="UpdateSellLocation"
                                                asp-route-id="@Model.Id"
                                                asp-route-locationName="@item.LocationName"
                                                class="btn btn-success btn-sm px-2 py-1"
                                                title="Edit Location"
                                                style="font-size: 14px; line-height: 1;">
                                                    <i class="fa fa-pencil" aria-hidden="true"></i>
                                                </a>

                                                <button type="button" 
                                                        class="delete-sell-location btn btn-danger btn-sm px-2 py-1" 
                                                        title="Delete Location"
                                                        style="font-size: 14px; line-height: 1;"
                                                        data-product-id="@Model.Id"
                                                        data-location-name="@item.LocationName">
                                                    <i class="fa fa-trash" aria-hidden="true"></i>
                                                </button>

                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                            <hr>
                            <div>
                                <table class="product-page-width">
                                    <tbody>
                                        <tr>
                                            <td style="white-space: nowrap;"> <b style="display: inline-block; width: 160px;">Created At</b><b>: &nbsp;&nbsp;&nbsp;</b></td>
                                            <td>
                                                @Model.CreatedAt.ToLocalTime().ToString("dd/MM/yy, HH:mm")
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style="white-space: nowrap;"> <b style="display: inline-block; width: 160px;">Update At</b><b>: &nbsp;&nbsp;&nbsp;</b></td>
                                            <td class="txt-success">
                                                @(
                                                    Model.UpdateAt.HasValue
                                                    ? Model.UpdateAt.Value.ToLocalTime().ToString("dd/MM/yy, HH:mm")
                                                    : "No update"
                                                    )
                                            </td>
                                        </tr>
                                        @if (Model.Sellocations != null && Model.Sellocations.Any())
                                        {
                                            foreach (var item in Model.Sellocations)
                                            {
                                                <tr>
                                                    <td style="white-space: nowrap;">
                                                        <b>Location Type Of @item.LocationName</b><b>: &nbsp;&nbsp;</b>
                                                    </td>
                                                    <td>
                                                        @if (item.Location != null && !string.IsNullOrEmpty(item.Location.Type))
                                                        {
                                                            <span>@item.Location.Type</span>
                                                        }
                                                        else
                                                        {
                                                            <span>No Location Type.</span>
                                                        }
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style="white-space: nowrap;">
                                                        <b style="display: inline-block; width: 160px;">Longitude/Latitude</b><b>: &nbsp;&nbsp;</b>
                                                    </td>
                                                    <td>
                                                        @if (item.Location != null && item.Location.Coordinates != null && item.Location.Coordinates.Any())
                                                        {
                                                            <span>@string.Join(", ", item.Location.Coordinates)</span>
                                                        }
                                                        else
                                                        {
                                                            <span>No Location Coordinates.</span>
                                                        }
                                                    </td>
                                                </tr>
                                            }
                                        }
                                        else
                                        {
                                            <tr>
                                                <td colspan="2"><span>No address information.</span></td>
                                            </tr>
                                        }

                                    </tbody>
                                </table>
                            </div>
                            <hr>
                            <div class="row">
                                <div class="col-md-4">
                                    <h6 class="product-title">Rate Now</h6>
                                </div>
                                <div class="col-md-8">
                                    <div class="d-flex gap-2">
                                        <div>
                                            @{
                                                int starCount = (int)Math.Floor((double)Model.OcopPoint);
                                                int totalStars = 5;
                                            }
                                            @for(int i = 1; i <= totalStars; i++)
                                            {
                                                if (i <= starCount)
                                                {
                                                    <i class="fa fa-star font-warning"></i>
                                                }
                                                else
                                                {
                                                    <i class="fa fa-star" style="color: #ccc;"></i>
                                                }
                                            }
                                        </div><span>(@Model.OcopPoint)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="m-t-15 btn-showcase">
                                <div class="d-inline">
                                    <a class="btn btn-success" asp-action="UpdateOcopProduct" asp-route-id="@Model.Id">
                                        <i class="fa fa-pencil" aria-hidden="true"></i>&nbsp; Edit Ocop Product
                                    </a>
                                </div>
                                <div class="d-inline">
                                    <a class="btn btn-danger" asp-action="Index">
                                        Back
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-xxl-3 col-md-6 box-col-6">
                    <div class="card">
                        <div class="card-body">
                            <!-- side-bar colleps block stat-->
                            <div class="filter-block">
                                <h4>Location</h4>   
                                <ul>
                                    <li>
                                        <td style="white-space: nowrap;">
                                            <b>Ocop Type Id</b><b>: &nbsp;&nbsp;</b>
                                        </td>
                                        @if(Model.OcopTypeId == "681c791ecf4b6508ed09e831"){
                                            <p>Ocop Product</p>
                                        }
                                    </li>
                                    <li>
                                        <td style="white-space: nowrap;">
                                            <b>Company Id</b><b>: &nbsp;&nbsp;</b>
                                        </td>
                                        @if(Model.CompanyId == "681c791ecf4b6508ed09e832"){
                                            <p>An Nam Company</p>
                                        }
                                    </li>
                                    <li>
                                        <td style="white-space: nowrap;">
                                            <b>Ocop Year Release</b><b>: &nbsp;&nbsp;</b>
                                        </td>
                                        <p>@Model.OcopYearRelease</p>
                                    </li>
                                    <li>
                                        <td style="white-space: nowrap;">
                                            <b>Tag Id</b><b>: &nbsp;&nbsp;</b>
                                        </td>
                                        @if(Model.TagId == "6826c8a67b645c6f8e188155"){
                                            <p>Introduce</p>
                                        }
                                        @if(Model.TagId == "6826c8a67b645c6f8e188156"){
                                            <p>Ocop</p>
                                        }
                                        @if(Model.TagId == "6826c8a67b645c6f8e188157"){
                                            <p>Tip Travel</p>
                                        }
                                        @if(Model.TagId == "6826c8a67b645c6f8e188158"){
                                            <p>Destination</p>
                                        }
                                        @if(Model.TagId == "6826c8a67b645c6f8e188159"){
                                            <p>Local specialty</p>
                                        }
                                        @if(Model.TagId == "6826c8a67b645c6f8e18815a"){
                                            <p>Stay</p>
                                        }
                                        @if(Model.TagId == "6826c8a67b645c6f8e18815b"){
                                            <p>Festivals</p>
                                        }
                                        @if(Model.TagId == "6826c8a67b645c6f8e18815c"){
                                            <p>Utilities</p>
                                        }
                                    </li>
                                    <li>
                                        <td style="white-space: nowrap;">
                                            <b>Selling Link Id</b><b>: &nbsp;&nbsp;</b>
                                        </td>
                                        }
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="row product-page-main">
                <div class="col-sm-12">
                    <ul class="nav nav-tabs border-tab nav-primary mb-0" id="top-tab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="top-home-tab" data-bs-toggle="tab"
                               href="#top-home" role="tab" aria-controls="top-home"
                               aria-selected="false">Description</a>
                            <div class="material-border"></div>
                        </li>
                    </ul>
                    <div class="tab-content" id="top-tabContent">
                        <div class="tab-pane fade active show" id="top-home" role="tabpanel"
                             aria-labelledby="top-home-tab">
                            <p class="mb-0 m-t-20">@Model.ProductDescription</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
    </div>
    <!-- Container-fluid Ends-->
</div>

@section Scripts {
    @Html.AntiForgeryToken()
    <script src="~/assets/js/sweetalert-custom.js"></script>
    <script src="~/assets/js/ocopproduct/index.js"></script>
    <script>
        (function () {
            const success = @Html.Raw(Json.Serialize(TempData["Success"]));
            const error = @Html.Raw(Json.Serialize(TempData["Error"]));
            if (success) showSuccessAlert("Success!", success);
            if (error) showErrorAlert("Error!", error);
        })();
        document.querySelector('.upload-placeholder').addEventListener('click', function() {
        document.querySelector('input[name="imageFile"]').click();
    });
        setTimeout(function () {
            var alert = document.getElementById("alert-message");
            if (alert) {
                alert.style.display = "none";
            }
        }, 2000);
    </script>
}
